module common

imports

  signatures/gazebo-core/-
  signatures/gazebo/-
  // BUG: this would have been sufficient (below), but transitive imports are not so great for source deps apparently
  signatures/-

  pp/gazebo-core-parenthesize
  pp/gazebo-core-pp
  pp/llmc-parenthesize
  pp/llmc-pp

  libspoofax/-

  libstratego-gpp

  str_common

strategies

  pp-gzbc =
      parenthesize-gazebo-core
    ; prettyprint-gazebo-core-start-symbols
    ; !V([], <id>)
    ; box2text-string(|120)

  pp-llmc =
      parenthesize-llmc
    ; prettyprint-llmc-start-symbols
    ; !V([], <id>)
    ; box2text-string(|120)

strategies

  relevant-tli =
    ?Function-C(_, _, _)
  + ?Decl-C(_, _, _)

  is-lit-or-ref =
    ?String-C(_)
  + ?BoolT-C()
  + ?BoolF-C()
  + ?NumB-C(_)
  + ?NumS-C(_)
  + ?NumI-C(_)
  + ?NumL-C(_)
  + ?NumF-C(_)
  + ?NumD-C(_)
  + ?RefFull-C(_)
  + ?RefLocal-C(_)

rules // nsid-ensure-valid :: string -> string

  nsid-ensure-valid =
    explode-string
  ; map(try(
      \<is-upper> -> ['-', <to-lower>]\
    + \'$' -> ['-', '-']\
    ))
  ; flatten-list
  ; implode-string

rules // nsid-from-base(|[ns | basename]) :: a | List(a) -> NSID-LL

  nsid-from-base(|[ns | basename]): name -> NSID-LL(ns, <concat; map(nsid-ensure-valid)> [basename, name])
    where is-list
  nsid-from-base(|base): name -> <nsid-from-base(|base)> [name]
    where not(is-list)
