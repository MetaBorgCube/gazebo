use entity~kill
use entity~summon
use util:geometry~rect
use world~setblock

// TODO: alias

const origin_1 := `(-8 3 -8)
const origin_2 := `(24 3 24)

const block_alive := $black_wool
const block_dead := $white_wool

const tag_transition_birth := "transition_birth"
const tag_transition_death := "transition_death"

// TODO: enums

user func reset
{
    kill(@CellHolder)
    fill(origin_1, origin_2, block_dead)
}

func init
{
    // Make sure no old cell holders are around anymore
    kill(@CellHolder)

    // Summon new cell holders at every block in the game grid, and configure them
    for x, y, z <- rect(origin_1, origin_2)
    positioned `(x y z)
    {
        // Summon an armor stand with the "cell_holder" tag, so it's reachable with @CellHolder
        summon($armor_stand, `(~ ~ ~), {
            Marker: true,
            Tags: ["cell_holder"]
        })

        as @CellHolder[distance = ..0.1]
        {
            if `(~ ~ ~) is block_alive
            {
                @s.tags.add("alive")
            }
        }
    }
}